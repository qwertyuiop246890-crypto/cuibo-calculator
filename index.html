<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>內部報價小幫手</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body class="bg-[#F2F2F7] min-h-screen flex flex-col">
    <div id="root" class="flex-grow flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [jpyPrice, setJpyPrice] = useState('');
            const [weight, setWeight] = useState('');
            const [bankRate, setBankRate] = useState(0.215);
            const [finalPrice, setFinalPrice] = useState(null);

            useEffect(() => {
                const numJpy = parseFloat(jpyPrice) || 0;
                const numWeight = parseFloat(weight) || 0;

                // 若未輸入日幣，則不顯示結果
                if (numJpy <= 0) {
                    setFinalPrice(null);
                    return;
                }

                // ==========================================
                // 【底層核心商業邏輯 (員工不可見)】
                // 以下參數皆鎖定為 V3.3「標準空運」之設定
                // ==========================================
                
                const currentRate = parseFloat(bankRate) || 0;
                const finalRate = currentRate + 0.02; // 匯率加碼 0.02
                
                // 1. 基礎成本計算
                const pureItemTwd = numJpy * finalRate;
                const ccFeeTwd = pureItemTwd * 0.015;     // 國外刷卡費 1.5%
                const shippingTwd = numWeight * 0.252;    // 空運費 0.252 TWD/g
                const sourcingFeeTwd = pureItemTwd * 0.10;// 代購費 10%
                const domesticTwd = 150 * finalRate;      // 日本境內運費 150 JPY

                const totalCost = pureItemTwd + ccFeeTwd + shippingTwd + sourcingFeeTwd + domesticTwd;

                // 2. 階梯保底利潤
                let profit = 0;
                if (totalCost < 100) profit = 40;
                else if (totalCost < 200) profit = 60;
                else if (totalCost < 300) profit = 80;
                else profit = Math.max(totalCost * 0.2, 100);

                // 3. 動態逆算除數 (平台3% + 營業稅5% + 會員緩衝3%)
                const divisorHigh = 0.89; // >= 400 啟動完整防禦
                const divisorLow = 0.92;  // < 400 不計會員緩衝

                let tempPrice = (totalCost + profit) / divisorHigh;
                
                if (tempPrice < 400) {
                    tempPrice = (totalCost + profit) / divisorLow;
                }

                // 4. 定價尾數修飾 (進位並強迫個位數為 9 或 0)
                const ceilPrice = Math.ceil(tempPrice);
                let calculatedPrice = ceilPrice;
                const lastDigit = ceilPrice % 10;
                
                if (lastDigit !== 0 && lastDigit !== 9) {
                    calculatedPrice = Math.floor(ceilPrice / 10) * 10 + 9;
                }

                setFinalPrice(calculatedPrice);
            }, [jpyPrice, weight, bankRate]);

            return (
                <div className="flex-grow flex flex-col pb-10">
                    {/* Header */}
                    <div className="bg-[#007AFF] pt-14 pb-6 px-6 shadow-md rounded-b-3xl mb-8">
                        <h1 className="text-2xl font-bold text-white tracking-tight text-center">報價小幫手</h1>
                        <p className="text-blue-100 text-sm mt-2 text-center font-medium opacity-90">快速精算，一鍵報價</p>
                    </div>

                    <div className="px-5 max-w-sm mx-auto w-full space-y-6 flex-grow">
                        
                        {/* 報價結果顯示區 (當有計算結果時顯著放大) */}
                        <div className={`transition-all duration-500 ease-in-out ${finalPrice ? 'opacity-100 translate-y-0 scale-100' : 'opacity-0 -translate-y-4 scale-95 hidden'}`}>
                            <div className="bg-white rounded-2xl shadow-lg p-6 text-center border-2 border-[#007AFF]/10 relative overflow-hidden">
                                <div className="absolute top-0 left-0 w-full h-1 bg-[#007AFF]"></div>
                                <div className="text-sm text-slate-500 font-semibold tracking-wider mb-2 uppercase">對客最終報價</div>
                                <div className="text-5xl font-extrabold text-[#007AFF] tracking-tight">
                                    <span className="text-2xl font-semibold mr-1 text-slate-400">NT$</span>
                                    {finalPrice || 0}
                                </div>
                            </div>
                        </div>

                        {/* 輸入區塊 */}
                        <div className="bg-white rounded-[16px] overflow-hidden shadow-sm border border-slate-100/60">
                            <div className="px-5 py-4 border-b border-slate-100 flex justify-between items-center">
                                <label className="text-[17px] font-medium text-black">日幣金額</label>
                                <div className="flex items-center">
                                    <input 
                                        type="number" inputMode="decimal" value={jpyPrice} 
                                        onChange={(e) => setJpyPrice(e.target.value)} 
                                        className="text-right text-2xl font-bold text-black focus:outline-none w-28 bg-transparent placeholder-slate-200" placeholder="0"
                                    />
                                    <span className="text-slate-400 ml-2 font-medium">¥</span>
                                </div>
                            </div>
                            
                            <div className="px-5 py-4 border-b border-slate-100 flex justify-between items-center">
                                <label className="text-[17px] font-medium text-black">商品重量</label>
                                <div className="flex items-center">
                                    <input 
                                        type="number" inputMode="decimal" value={weight} 
                                        onChange={(e) => setWeight(e.target.value)} 
                                        className="text-right text-2xl font-bold text-black focus:outline-none w-28 bg-transparent placeholder-slate-200" placeholder="0"
                                    />
                                    <span className="text-slate-400 ml-2 font-medium">g</span>
                                </div>
                            </div>

                            <div className="px-5 py-4 bg-slate-50/50 flex justify-between items-center">
                                <label className="text-[15px] font-medium text-slate-500">今日台銀賣出</label>
                                <input 
                                    type="number" inputMode="decimal" step="0.0001" value={bankRate} 
                                    onChange={(e) => setBankRate(e.target.value)} 
                                    className="text-right text-lg font-semibold text-slate-600 focus:outline-none w-24 bg-transparent" 
                                />
                            </div>
                        </div>

                        {/* 狀態提示 */}
                        {!finalPrice && (
                            <div className="text-center text-slate-400 text-sm mt-8 animate-pulse">
                                請輸入日幣金額與重量以產生報價
                            </div>
                        )}
                        
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
